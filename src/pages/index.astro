---
const base = import.meta.env.BASE_URL;

// Helper to build correct image URL on subfolders
const img = (path: string) => `${base}${path.replace(/^\/+/, "")}`;

const products = [
  {
    id: "set-black",
    name: "Black Satin-Look Cami & Shorts Set",
    price: 499,
    image: "/images/set-black.png",
    colors: ["Black"],
    sizes: ["S", "M", "L"],
  },
  {
    id: "set-white",
    name: "White Satin-Look Cami & Shorts Set",
    price: 499,
    image: "/images/set-white.png",
    colors: ["White"],
    sizes: ["S", "M", "L"],
  },
  {
    id: "nude-slip",
    name: "Nude Satin-Look Slip Dress",
    price: 499,
    image: "/images/nude-slipp-dress.png",
    colors: ["Nude"],
    sizes: ["S", "M", "L"],
  },
  {
    id: "white-slip",
    name: "White Satin-Look Slip Dress",
    price: 499,
    image: "/images/white-slip-dress.png",
    colors: ["White"],
    sizes: ["S", "M", "L"],
  },
  {
    id: "black-chemise",
    name: "Black Satin-Look Chemise Dress",
    price: 499,
    image: "/images/black-chemise.png",
    colors: ["Black"],
    sizes: ["S", "M", "L"],
  },
  {
    id: "white-soft-bra",
    name: "White Soft Comfort Bra",
    price: 380,
    image: "/images/white-soft-bra.png",
    colors: ["White"],
    sizes: ["75B", "80B", "85B", "90B", "95B"],
  },
  {
    id: "black-soft-bra",
    name: "Black Soft Comfort Bra",
    price: 380,
    image: "/images/black-soft-bra.png",
    colors: ["Black"],
    sizes: ["75B", "80B", "85B", "90B", "95B"],
  },
];
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Amicbridge</title>

  <style>
    :root{--bg:#f7f6f4;--text:#151515;--muted:#6b6b6b;--border:#dedede;--card:#fff;}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{padding:22px 40px;display:flex;justify-content:space-between;align-items:center}
    main{max-width:1100px;margin:0 auto;padding:0 40px 70px}
    a{text-decoration:none;color:var(--text)}
    .muted{color:var(--muted)}
    .card{background:#fff;border:1px solid var(--border);padding:14px;border-radius:12px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:20px}
    img.product{width:100%;height:260px;object-fit:cover;border-radius:12px;border:1px solid var(--border);background:#fff}
    select,button{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);margin-top:10px}
    button{background:#151515;color:#fff;font-weight:900;cursor:pointer;border-color:#151515}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    @media(max-width:900px){main,header{padding:18px}.grid{grid-template-columns:1fr}}
  </style>
</head>

<body>
  <header>
    <div>
      <strong>Amicbridge</strong>
      <div class="muted">Satin-look sleepwear</div>
    </div>

    <!-- IMPORTANT: use base + string (safe) -->
    <a href={base + "checkout/"}><strong>Checkout →</strong></a>
  </header>

  <main>
    <h1 style="margin:0 0 6px;font-size:34px">Shop</h1>
    <div class="muted">Add to cart, pay with Vipps, we ship after payment.</div>

    <!-- VIPPS QR SECTION -->
    <section style="margin-top:22px;max-width:820px">
      <div class="card">
        <div style="font-weight:900;font-size:18px;margin-bottom:6px">Pay with Vipps</div>
        <div class="muted" style="line-height:1.4">
          Scan the QR code with Vipps to pay. Then go to checkout and send your order details.
        </div>

        <div style="margin-top:10px;font-weight:900">Vipps number: 92928373</div>

        <img
          src="/images/vipps-qr.jpg"
          alt="Vipps QR"
          style="margin-top:12px;width:260px;max-width:100%;border:1px solid #dedede;border-radius:16px;background:#fff"
        />

        <div style="margin-top:12px">
          <a
            href={base + "checkout/"}
            style="display:inline-block;padding:12px 14px;background:#151515;color:#fff;border-radius:12px;font-weight:900"
          >
            Go to checkout
          </a>
        </div>

        <div class="muted" style="margin-top:10px;font-size:12px">
          Tip: Vipps private payments are confirmed manually after payment is received.
        </div>
      </div>
    </section>

    <!-- PRODUCTS -->
    <div class="grid">
      {products.map((p) => (
        <div class="card" data-id={p.id} data-name={p.name} data-price={p.price} data-image={img(p.image)}>
          <img class="product" src={img(p.image)} alt={p.name} />
          <div style="margin-top:10px;font-weight:900">{p.name}</div>
          <div class="muted">{p.price} NOK</div>

          <div class="row">
            <select class="size">
              {p.sizes.map((s) => <option value={s}>{s}</option>)}
            </select>

            <select class="color">
              {p.colors.map((c) => <option value={c}>{c}</option>)}
            </select>
          </div>

          <button class="add" type="button">Add to cart</button>
        </div>
      ))}
    </div>
  </main>

  <script>
    function readCart(){ try{return JSON.parse(localStorage.getItem("cart")||"[]")}catch{return []} }
    function writeCart(c){ localStorage.setItem("cart", JSON.stringify(c)); }

    document.addEventListener("click", (e) => {
      const btn = e.target.closest(".add");
      if (!btn) return;

      const card = btn.closest(".card");
      const id = card.dataset.id;
      const name = card.dataset.name;
      const price = Number(card.dataset.price);
      const image = card.dataset.image;

      const size = card.querySelector(".size").value;
      const color = card.querySelector(".color").value;

      const cart = readCart();
      const existing = cart.find(it => it.id === id && it.size === size && it.color === color);

      if (existing) existing.quantity += 1;
      else cart.push({ id, name, price, size, color, image, quantity: 1 });

      writeCart(cart);

      btn.textContent = "Added ✓";
      setTimeout(() => btn.textContent = "Add to cart", 900);
    });
  </script>
</body>
</html>
