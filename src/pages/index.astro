---
const products = [
  {
    id: "set-white",
    name: "Lace Bra & Panty Set",
    priceNok: 350,
    image: "/images/set-white.png",
    defaultColor: "White",
    colors: ["White", "Black"],
    sizes: ["75B", "80B", "85B", "90B", "95B"],
  },
  {
    id: "set-black",
    name: "Classic Black Lace Set",
    priceNok: 350,
    image: "/images/set-black.png",
    defaultColor: "Black",
    colors: ["Black", "White"],
    sizes: ["75B", "80B", "85B", "90B", "95B"],
  },
];
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Amicbridge — Women’s Underwear</title>

    <style>
      :root { --border:#e5e5e5; --text:#111; --muted:#666; --bg:#fafafa; }
      body { margin:0; font-family: system-ui, sans-serif; background:var(--bg); color:var(--text); }
      header { padding:24px 40px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; gap:16px; }
      header h1 { margin:0; font-size:18px; letter-spacing:2px; text-transform:uppercase; }
      header .mini { color:var(--muted); font-size:13px; }

      main { max-width:1200px; margin:0 auto; }
      .products { padding:40px; display:grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap:30px; }

      .product { background:#fff; border:1px solid var(--border); padding:16px; display:flex; flex-direction:column; gap:12px; }
      .product img { width:100%; height:360px; object-fit:cover; background:#f0f0f0; border:1px solid var(--border); }
      .title { display:flex; justify-content:space-between; gap:12px; align-items:flex-start; }
      .title h2 { margin:0; font-size:16px; }
      .price { margin:0; font-weight:600; color:#222; white-space:nowrap; }
      .sub { margin:0; color:var(--muted); font-size:13px; }

      .sectionLabel { margin:8px 0 6px; font-size:13px; color:var(--muted); letter-spacing:.04em; text-transform:uppercase; }
      .grid { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:10px; }
      .pillgrid { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:10px; }

      .optionBtn {
        border:1px solid var(--border);
        background:#fff;
        padding:14px 10px;
        cursor:pointer;
        text-align:center;
        font-size:16px;
        user-select:none;
      }
      .optionBtn[aria-pressed="true"] { border-color:#111; outline:2px solid #1111; }

      .row { display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .qty {
        display:grid;
        grid-template-columns: 52px 64px 52px;
        border:1px solid var(--border);
        width:max-content;
      }
      .qty button {
        border:0;
        background:#fff;
        padding:12px 0;
        cursor:pointer;
        font-size:18px;
      }
      .qty div {
        display:flex;
        align-items:center;
        justify-content:center;
        border-left:1px solid var(--border);
        border-right:1px solid var(--border);
        font-size:14px;
      }

      .actions { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:8px; }
      .primary, .secondary {
        width:100%;
        padding:12px 10px;
        border:1px solid #111;
        cursor:pointer;
        font-size:14px;
        background:#fff;
      }
      .primary { background:#111; color:#fff; }
      .secondary { border-color:var(--border); color:#111; }

      .hint { font-size:12px; color:var(--muted); margin:0; }

      .contact {
        padding:40px;
        border-top:1px solid var(--border);
        margin:0 40px 40px;
        background:#fff;
        border:1px solid var(--border);
      }
      .contact h3 { margin:0 0 10px; font-size:16px; }
      .contact p { margin:6px 0; color:#222; }
      .contact a { color:#111; text-decoration:none; border-bottom:1px solid #111; }
    </style>
  </head>

  <body>
    <header>
      <h1>Amicbridge</h1>
      <div class="mini">
        Cart: <span id="cartCount">0</span> item(s)
      </div>
    </header>

    <main>
      <section class="products">
        {products.map((p) => (
          <article class="product" data-product-id={p.id} data-price={p.priceNok}>
            <img src={p.image} alt={p.name} />

            <div class="title">
              <div>
                <h2>{p.name}</h2>
                <p class="sub">Select size & color, then add to cart</p>
              </div>
              <p class="price">{p.priceNok} NOK</p>
            </div>

            <div>
              <div class="sectionLabel">Size</div>
              <div class="grid" data-size-grid>
                {p.sizes.map((s) => (
                  <button class="optionBtn" type="button" data-size={s} aria-pressed="false">{s}</button>
                ))}
              </div>
            </div>

            <div>
              <div class="sectionLabel">Color</div>
              <div class="pillgrid" data-color-grid>
                {p.colors.map((c) => (
                  <button class="optionBtn" type="button" data-color={c} aria-pressed={c === p.defaultColor ? "true" : "false"}>{c}</button>
                ))}
              </div>
            </div>

            <div class="row">
              <div>
                <div class="sectionLabel">Quantity</div>
                <div class="qty" role="group" aria-label="Quantity selector">
                  <button type="button" data-qty-minus aria-label="Decrease quantity">-</button>
                  <div data-qty-value>1</div>
                  <button type="button" data-qty-plus aria-label="Increase quantity">+</button>
                </div>
              </div>

              <div style="flex:1; text-align:right;">
                <div class="sectionLabel">Selected</div>
                <div class="hint">
                  Size: <span data-selected-size>—</span> • Color: <span data-selected-color>{p.defaultColor}</span>
                </div>
              </div>
            </div>

            <div class="actions">
              <button class="secondary" type="button" data-clear>Clear</button>
              <button class="primary" type="button" data-add>Add to cart</button>
            </div>

            <p class="hint" data-message></p>
          </article>
        ))}
      </section>

      <section class="contact">
        <h3>Contact</h3>
        <p><strong>CEO:</strong> Robert</p>
        <p><strong>Phone:</strong> <a href="tel:92928373">92928373</a></p>
      </section>
    </main>

    <script>
      const CART_KEY = "amicbridge_cart_v1";

      function readCart() {
        try { return JSON.parse(localStorage.getItem(CART_KEY) || "[]"); }
        catch { return []; }
      }

      function writeCart(cart) {
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
        updateCartCount();
      }

      function updateCartCount() {
        const cart = readCart();
        const count = cart.reduce((sum, item) => sum + (item.qty || 0), 0);
        const el = document.getElementById("cartCount");
        if (el) el.textContent = String(count);
      }

      function setPressed(groupEl, selector, valueAttr, value) {
        groupEl.querySelectorAll(selector).forEach(btn => {
          const v = btn.getAttribute(valueAttr);
          btn.setAttribute("aria-pressed", v === value ? "true" : "false");
        });
      }

      function getPressedValue(groupEl, selector, valueAttr) {
        const pressed = groupEl.querySelector(`${selector}[aria-pressed="true"]`);
        return pressed ? pressed.getAttribute(valueAttr) : null;
      }

      function showMsg(card, text, ok=true) {
        const msg = card.querySelector("[data-message]");
        if (!msg) return;
        msg.textContent = text;
        msg.style.color = ok ? "#1a7f37" : "#b42318";
      }

      // Setup all product cards
      document.querySelectorAll("[data-product-id]").forEach(card => {
        const sizeGrid = card.querySelector("[data-size-grid]");
        const colorGrid = card.querySelector("[data-color-grid]");
        const qtyValueEl = card.querySelector("[data-qty-value]");
        const selectedSizeEl = card.querySelector("[data-selected-size]");
        const selectedColorEl = card.querySelector("[data-selected-color]");

        const defaultColorBtn = colorGrid.querySelector('[aria-pressed="true"]');
        if (defaultColorBtn && selectedColorEl) selectedColorEl.textContent = defaultColorBtn.textContent.trim();

        // Size buttons
        sizeGrid.querySelectorAll("[data-size]").forEach(btn => {
          btn.addEventListener("click", () => {
            const size = btn.getAttribute("data-size");
            setPressed(sizeGrid, "[data-size]", "data-size", size);
            if (selectedSizeEl) selectedSizeEl.textContent = size;
            showMsg(card, "");
          });
        });

        // Color buttons
        colorGrid.querySelectorAll("[data-color]").forEach(btn => {
          btn.addEventListener("click", () => {
            const color = btn.getAttribute("data-color");
            setPressed(colorGrid, "[data-color]", "data-color", color);
            if (selectedColorEl) selectedColorEl.textContent = color;
            showMsg(card, "");
          });
        });

        // Qty
        card.querySelector("[data-qty-minus]").addEventListener("click", () => {
          const n = Math.max(1, parseInt(qtyValueEl.textContent || "1", 10) - 1);
          qtyValueEl.textContent = String(n);
        });
        card.querySelector("[data-qty-plus]").addEventListener("click", () => {
          const n = Math.min(99, parseInt(qtyValueEl.textContent || "1", 10) + 1);
          qtyValueEl.textContent = String(n);
        });

        // Clear
        card.querySelector("[data-clear]").addEventListener("click", () => {
          // reset size
          setPressed(sizeGrid, "[data-size]", "data-size", "__none__");
          if (selectedSizeEl) selectedSizeEl.textContent = "—";

          // reset color to first default pressed or first button
          const fallback = colorGrid.querySelector("[data-color]");
          const def = colorGrid.querySelector('[aria-pressed="true"]') || fallback;
          const color = def ? def.getAttribute("data-color") : null;
          if (color) setPressed(colorGrid, "[data-color]", "data-color", color);
          if (selectedColorEl) selectedColorEl.textContent = color || "—";

          // reset qty
          qtyValueEl.textContent = "1";
          showMsg(card, "Cleared.");
        });

        // Add to cart
        card.querySelector("[data-add]").addEventListener("click", () => {
          const productId = card.getAttribute("data-product-id");
          const name = card.querySelector("h2")?.textContent?.trim() || "Product";
          const price = parseInt(card.getAttribute("data-price") || "0", 10);

          const size = getPressedValue(sizeGrid, "[data-size]", "data-size");
          const color = getPressedValue(colorGrid, "[data-color]", "data-color");
          const qty = parseInt(qtyValueEl.textContent || "1", 10);

          if (!size) {
            showMsg(card, "Please select a size.", false);
            return;
          }
          if (!color) {
            showMsg(card, "Please select a color.", false);
            return;
          }

          const cart = readCart();

          // Merge same product + same variant
          const existing = cart.find(i => i.productId === productId && i.size === size && i.color === color);
          if (existing) existing.qty += qty;
          else cart.push({ productId, name, price, size, color, qty });

          writeCart(cart);
          showMsg(card, "Added to cart ✅");
        });
      });

      updateCartCount();
    </script>
  </body>
</html>

